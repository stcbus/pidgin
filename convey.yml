environment:
  - DOCS_BUILD_IMAGE=pidgin/2.x.y-builders:debian-bookworm-amd64

tasks:
  clean:
    type: convey/clean
    files:
      - pidgin2-docs

  docs-build:
    type: docker/run
    image: ${DOCS_BUILD_IMAGE}
    workdir: ${CONVEY_WORKSPACE}
    script:
      - set -ex
      - ./autogen.sh --disable-gevolution
      - make -s -j$(nproc) docs

  docs-clean:
    type: convey/clean
    files:
      - pidgin2-docs

  docs-export:
    type: docker/export
    files:
      - doc/html:pidgin2-docs

  import:
    type: docker/import
    files: .:.

plans:
  clean:
    stages:
      - tasks: [clean]

  docs:
    stages:
      - tasks: [docs-clean, import, docs-build, docs-export]
